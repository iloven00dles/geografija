<!DOCTYPE html>
<html lang="lt">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S9FGG9GK89"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-S9FGG9GK89');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geografijos kartojimas</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; height: 100vh; }
        #header { background-color: #2c3e50; color: white; padding: 15px; text-align: center; display: flex; justify-content: space-between; align-items: center; }
        #task-box { background-color: #ecf0f1; padding: 15px; text-align: center; font-size: 1.2em; border-bottom: 2px solid #bdc3c7; }
        #map { flex-grow: 1; width: 100%; cursor: crosshair; }
        .target-name { font-weight: bold; color: #e74c3c; }
        .btn { background-color: #27ae60; color: white; border: none; padding: 10px 20px; cursor: pointer; font-size: 1em; border-radius: 5px; margin: 5px; }
        .btn:hover { background-color: #2ecc71; }
        .btn-secondary { background-color: #3498db; }
        .btn-secondary:hover { background-color: #5dade2; }
        .info-panel { font-size: 0.9em; }
        #feedback { margin-top: 10px; font-weight: bold; min-height: 24px; }

        /* Stiliai teisingam/neteisingam atsakymui */
        .correct { color: #27ae60; }
        .incorrect { color: #c0392b; }
        .partial { color: #f39c12; }

        /* Pradinis ekranas */
        #start-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(44, 62, 80, 0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; color: white; overflow-y: auto; padding: 20px; }
        #start-screen h1 { font-size: 2.5em; margin-bottom: 20px; }
        #start-screen h2 { font-size: 1.5em; margin-bottom: 15px; margin-top: 30px; }
        #start-screen p { font-size: 1.2em; margin-bottom: 20px; }
        .exam-options { display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; max-width: 600px; }
        .exam-btn { background-color: #e74c3c; padding: 15px 30px; font-size: 1.1em; }
        .exam-btn:hover { background-color: #c0392b; }

        /* ObjektÅ³ tipÅ³ pasirinkimas */
        .type-selection { max-width: 700px; margin: 20px auto; }
        .type-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .type-checkbox { display: none; }
        .type-label { padding: 12px; background-color: #34495e; border: 2px solid #34495e; border-radius: 5px; cursor: pointer; text-align: center; transition: all 0.3s; }
        .type-label:hover { background-color: #4a5f7f; }
        .type-checkbox:checked + .type-label { background-color: #27ae60; border-color: #27ae60; }
        .select-buttons { display: flex; gap: 10px; justify-content: center; margin-bottom: 15px; }
        .select-btn { background-color: #7f8c8d; padding: 8px 16px; font-size: 0.9em; }
        .select-btn:hover { background-color: #95a5a6; }

        /* RezultatÅ³ lentelÄ— */
        #results-table { max-width: 600px; margin: 20px auto; background: white; color: #2c3e50; padding: 20px; border-radius: 10px; max-height: 60vh; overflow-y: auto; }
        #results-table table { width: 100%; border-collapse: collapse; }
        #results-table th, #results-table td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
        #results-table th { background-color: #34495e; color: white; }
        .grade-excellent { color: #27ae60; font-weight: bold; }
        .grade-good { color: #f39c12; font-weight: bold; }
        .grade-fail { color: #c0392b; font-weight: bold; }
    </style>
</head>
<body>

<div id="start-screen">
    <h1>ğŸŒ Geografijos Egzaminas</h1>

    <div class="type-selection">
        <h2>Pasirinkite kÄ… mokytis:</h2>
        <div class="select-buttons">
            <button class="btn select-btn" onclick="selectAllTypes()">âœ“ Visi</button>
            <button class="btn select-btn" onclick="deselectAllTypes()">âœ— Nieko</button>
        </div>
        <div class="type-grid">
            <div>
                <input type="checkbox" id="type-sala" class="type-checkbox" checked>
                <label for="type-sala" class="type-label">ğŸï¸ Salos</label>
            </div>
            <div>
                <input type="checkbox" id="type-salynas" class="type-checkbox" checked>
                <label for="type-salynas" class="type-label">ğŸï¸ Salynai</label>
            </div>
            <div>
                <input type="checkbox" id="type-pusiasalis" class="type-checkbox" checked>
                <label for="type-pusiasalis" class="type-label">ğŸ—ºï¸ Pusiasaliai</label>
            </div>
            <div>
                <input type="checkbox" id="type-jura" class="type-checkbox" checked>
                <label for="type-jura" class="type-label">ğŸŒŠ JÅ«ros</label>
            </div>
            <div>
                <input type="checkbox" id="type-ilanka" class="type-checkbox" checked>
                <label for="type-ilanka" class="type-label">ğŸŒŠ Ä®lankos</label>
            </div>
            <div>
                <input type="checkbox" id="type-sasiauris" class="type-checkbox" checked>
                <label for="type-sasiauris" class="type-label">ã€°ï¸ SÄ…siauriai</label>
            </div>
            <div>
                <input type="checkbox" id="type-kanalas" class="type-checkbox" checked>
                <label for="type-kanalas" class="type-label">ğŸš¢ Kanalai</label>
            </div>
        </div>
    </div>

    <h2>Pasirinkite egzamino ilgÄ¯:</h2>
    <div class="exam-options">
        <button class="btn exam-btn" onclick="startExam(10)">10 klausimÅ³</button>
        <button class="btn exam-btn" onclick="startExam(20)">20 klausimÅ³</button>
        <button class="btn exam-btn" onclick="startExam(30)">30 klausimÅ³</button>
        <button class="btn exam-btn" onclick="startExam('all')">Visi pasirinkti</button>
    </div>
</div>

<div id="header">
    <div>TaÅ¡kai: <span id="score">0</span> / <span id="max-score">0</span></div>
    <div class="info-panel">Klausimas <span id="question-num">1</span> / <span id="total-questions">10</span></div>
    <div>Vidurkis: <span id="avg-score">0</span>%</div>
</div>

<div id="task-box">
    <div id="question-text">Kraunama...</div>
    <div id="feedback"></div>
    <button id="next-btn" class="btn" onclick="nextLevel()" style="display: none;">Kitas klausimas &rarr;</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // 1. Å½emÄ—lapio inicijavimas
    // Centruojame ties Europa/Afrika pradÅ¾iai, zoom lygis 3
    const map = L.map('map').setView([20, 0], 2);

    // Naudojame Å¾emÄ—lapÄ¯ be pavadinimÅ³, bet su visais kontÅ«rais
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
        subdomains: 'abcd',
        maxZoom: 20,
        noWrap: true
    }).addTo(map);

 // 2. DuomenÅ³ bazÄ— (Lokacijos su GeoJSON kontÅ«rais)
// Atnaujinti, tikslesni kontÅ«rai (High-fidelity simplified)
const locations = [
    // --- SALOS ---
    {
        name: "Grenlandija",
        type: "Sala",
        polygon: [
            [83.6, -30.0], [81.0, -15.0], [70.0, -20.0], [60.0, -43.0], 
            [59.8, -45.0], [61.0, -50.0], [64.0, -52.0], [75.0, -60.0], 
            [78.0, -70.0], [82.0, -65.0], [83.6, -30.0]
        ]
    },
    {
        name: "Islandija",
        type: "Sala",
        polygon: [
            [66.5, -16.0], [66.0, -14.5], [64.5, -14.0], [63.5, -18.0], 
            [63.4, -20.0], [63.8, -22.5], [65.5, -24.0], [66.5, -23.0], 
            [66.5, -16.0]
        ]
    },
    {
        name: "Kuba",
        type: "Sala",
        polygon: [
            [23.1, -81.0], [22.5, -78.0], [21.0, -75.5], [20.0, -74.0], 
            [19.8, -77.5], [21.5, -83.0], [21.9, -84.9], [22.8, -84.0], 
            [23.1, -81.0]
        ]
    },
    {
        name: "Naujoji Zelandija",
        type: "Sala",
        // Apima abi pagrindines salas vienu kontÅ«ru
        polygon: [
            [-34.4, 172.7], [-36.5, 175.5], [-37.5, 178.0], [-41.6, 174.0], 
            [-46.0, 169.0], [-47.3, 167.0], [-45.0, 166.0], [-40.5, 172.0], 
            [-38.0, 174.5], [-35.0, 173.0], [-34.4, 172.7]
        ]
    },
    {
        name: "Madagaskaras",
        type: "Sala",
        polygon: [
            [-12.0, 49.3], [-15.0, 50.5], [-20.0, 48.5], [-25.6, 45.2], 
            [-25.0, 44.0], [-20.0, 44.0], [-16.0, 45.0], [-13.0, 48.0], 
            [-12.0, 49.3]
        ]
    },
    {
        name: "Sicilija",
        type: "Sala",
        polygon: [
            [38.3, 15.6], [38.2, 13.0], [37.8, 12.4], [36.7, 12.5], 
            [36.6, 15.1], [37.0, 15.3], [38.3, 15.6]
        ]
    },
    {
        name: "Britanija",
        type: "Sala",
        polygon: [
            [58.6, -3.5], [57.5, -2.0], [53.0, 1.0], [51.0, 1.5], 
            [50.0, -5.5], [51.5, -5.0], [52.0, -4.0], [54.5, -3.5], 
            [55.0, -5.5], [57.0, -6.0], [58.6, -3.5]
        ]
    },
    {
        name: "Bafino Å¾emÄ—",
        type: "Sala",
        polygon: [
            [73.8, -80.0], [70.0, -68.0], [66.0, -62.0], [62.0, -65.0], 
            [64.0, -75.0], [68.0, -80.0], [73.8, -80.0]
        ]
    },
    {
        name: "Kalimantanas (Borneo)",
        type: "Sala",
        polygon: [
            [7.0, 117.0], [4.0, 118.0], [1.0, 119.0], [-4.0, 115.0], 
            [-3.0, 110.0], [0.0, 109.0], [2.0, 110.0], [7.0, 116.0], 
            [7.0, 117.0]
        ]
    },
    {
        name: "Sumatra",
        type: "Sala",
        polygon: [
            [5.5, 95.5], [4.0, 98.0], [0.0, 103.0], [-5.0, 106.0], 
            [-6.0, 104.5], [-3.0, 100.0], [2.0, 97.0], [5.5, 95.5]
        ]
    },
    {
        name: "Naujoji GvinÄ—ja (Papua)",
        type: "Sala",
        polygon: [
            [-0.5, 131.0], [-1.0, 137.0], [-3.0, 142.0], [-6.0, 147.0], 
            [-10.0, 150.0], [-9.0, 141.0], [-6.0, 138.0], [-4.0, 134.0], 
            [-0.5, 131.0]
        ]
    },

    // --- SALYNAI (Poligonai apima salÅ³ grupes) ---
    {
        name: "HavajÅ³ salynas",
        type: "Salynas",
        polygon: [
            [22.5, -159.0], [20.0, -155.0], [18.8, -155.0], [19.0, -156.0], 
            [21.5, -160.0], [22.5, -159.0]
        ]
    },
    {
        name: "FilipinÅ³ salynas",
        type: "Salynas",
        polygon: [
            [19.0, 121.0], [13.0, 125.0], [6.0, 127.0], [5.0, 120.0], 
            [9.0, 117.0], [16.0, 119.5], [19.0, 121.0]
        ]
    },
    {
        name: "MalajÅ³ salynas",
        type: "Salynas",
        polygon: [
            [5.0, 95.0], [5.0, 120.0], [-10.0, 120.0], [-10.0, 100.0], 
            [5.0, 95.0]
        ]
    },
    {
        name: "Japonijos salynas",
        type: "Salynas",
        polygon: [
            [45.5, 142.0], [42.0, 144.0], [35.0, 141.0], [31.0, 131.0], 
            [33.0, 129.0], [40.0, 139.0], [45.5, 142.0]
        ]
    },
    {
        name: "KanarÅ³ salynas",
        type: "Salynas",
        polygon: [
            [29.5, -13.0], [28.0, -13.0], [27.5, -18.0], [29.0, -18.0], 
            [29.5, -13.0]
        ]
    },

    // --- PUSIASALIAI ---
    {
        name: "Indokinijos pusiasalis",
        type: "Pusiasalis",
        polygon: [
            [22.0, 92.0], [22.0, 105.0], [10.0, 109.0], [8.0, 105.0], 
            [6.0, 100.0], [10.0, 98.0], [16.0, 94.0], [22.0, 92.0]
        ]
    },
    {
        name: "Skandinavijos pusiasalis",
        type: "Pusiasalis",
        polygon: [
            [71.0, 28.0], [60.0, 18.0], [55.5, 13.0], [58.0, 6.0], 
            [62.0, 5.0], [70.0, 20.0], [71.0, 28.0]
        ]
    },
    {
        name: "Labradoro pusiasalis",
        type: "Pusiasalis",
        polygon: [
            [60.0, -64.0], [55.0, -55.0], [52.0, -55.0], [50.0, -70.0], 
            [58.0, -75.0], [62.0, -75.0], [60.0, -64.0]
        ]
    },
    {
        name: "Indostano pusiasalis",
        type: "Pusiasalis",
        polygon: [
            [25.0, 67.0], [15.0, 73.0], [8.0, 77.5], [15.0, 80.0], 
            [22.0, 88.0], [25.0, 85.0], [25.0, 67.0]
        ]
    },
    {
        name: "Arabijos pusiasalis",
        type: "Pusiasalis",
        polygon: [
            [30.0, 35.0], [13.0, 43.0], [15.0, 53.0], [23.0, 59.0], 
            [30.0, 48.0], [30.0, 35.0]
        ]
    },
    {
        name: "Kalifornijos pusiasalis",
        type: "Pusiasalis",
        polygon: [
            [32.5, -117.0], [32.0, -114.5], [23.0, -109.0], [23.0, -110.0], 
            [32.5, -117.0]
        ]
    },

    // --- JÅªROS ---
    {
        name: "Å iaurÄ—s jÅ«ra",
        type: "JÅ«ra",
        polygon: [
            [61.0, 4.0], [58.0, 8.0], [54.0, 8.0], [51.0, 2.0], 
            [53.0, 0.0], [58.0, -2.0], [61.0, 4.0]
        ]
    },
    {
        name: "KaribÅ³ jÅ«ra",
        type: "JÅ«ra",
        polygon: [
            [22.0, -85.0], [20.0, -75.0], [15.0, -65.0], [10.0, -65.0], 
            [9.0, -80.0], [15.0, -88.0], [22.0, -85.0]
        ]
    },
    {
        name: "VidurÅ¾emio jÅ«ra",
        type: "JÅ«ra",
        polygon: [
            [44.0, 8.0], [40.0, 18.0], [36.0, 35.0], [31.0, 34.0], 
            [31.0, 15.0], [36.0, -5.0], [44.0, 8.0]
        ]
    },
    {
        name: "Juodoji jÅ«ra",
        type: "JÅ«ra",
        polygon: [
            [46.5, 30.0], [44.0, 41.0], [41.0, 41.0], [41.0, 28.0], 
            [46.5, 30.0]
        ]
    },
    {
        name: "Baltijos jÅ«ra",
        type: "JÅ«ra",
        // Pataisyta: Ä¯trauktos Botnijos ir Suomijos Ä¯lankos, tikslesnÄ— Skandinavijos ir Baltijos Å¡aliÅ³ pakrantÄ—
        polygon: [
            [54.5, 9.8],   // Vokietija/Danija (Kylio Ä¯lanka)
            [56.0, 12.5],  // Ties Kopenhaga
            [55.3, 13.0],  // Å vedijos pietÅ«s
            [56.0, 16.5],  // Å vedijos pakrantÄ—
            [59.0, 18.0],  // Stokholmo archipelagas
            [60.5, 17.5],  // Botnijos Ä¯lankos pradÅ¾ia (Å vedija)
            [65.8, 22.0],  // Botnijos Ä¯lankos virÅ¡us (LulÄ—jas)
            [65.0, 25.5],  // Suomijos pakrantÄ— (Oulu)
            [60.0, 23.0],  // Turku apylinkÄ—s
            [60.5, 27.0],  // Kotka (Suomijos Ä¯lankos Å¡iaurÄ—)
            [60.0, 30.0],  // Sankt Peterburgas
            [59.4, 28.0],  // Estijos Å¡iaurÄ— (Narva/Talinas)
            [58.0, 22.5],  // Saremos sala
            [57.0, 24.0],  // Rygos Ä¯lanka
            [57.5, 21.5],  // Ventspilis
            [56.0, 21.0],  // KlaipÄ—da
            [54.5, 19.5],  // Kaliningradas
            [54.0, 14.5],  // Lenkijos/Vokietijos siena
            [54.5, 9.8]    // GrÄ¯Å¾imas Ä¯ pradÅ¾iÄ…
        ]
    },
{
        name: "JaponÅ³ jÅ«ra",
        type: "JÅ«ra",
        // Pataisyta: atsiskirta nuo Ramiojo vandenyno ties Japonija ir Sachalinu
        polygon: [
            [51.4, 140.5], // TotoriÅ³ sÄ…siaurio virÅ¡us
            [46.0, 142.0], // Sachalino pietÅ«s
            [45.5, 142.0], // La PerÅ«zo sÄ…siauris
            [43.5, 141.0], // Hokaido sala (Japonija)
            [41.5, 140.0], // Cugaru sÄ…siauris
            [35.0, 131.0], // PietÅ³ KorÄ—jos sÄ…siauris (ties Fukuoka)
            [34.0, 129.0], // CuÅ¡imos sÄ…siauris
            [35.5, 129.5], // PietÅ³ KorÄ—jos pakrantÄ—
            [42.0, 130.5], // Å iaurÄ—s KorÄ—jos/Rusijos siena
            [46.0, 138.0], // PrimorÄ—s kraÅ¡tas (Rusija)
            [51.4, 140.5]
        ]
    },
    {
        name: "ArabÅ³ jÅ«ra",
        type: "JÅ«ra",
        polygon: [
            [25.0, 60.0], [20.0, 70.0], [10.0, 75.0], [10.0, 55.0], 
            [25.0, 60.0]
        ]
    },
{
        name: "Raudonoji jÅ«ra",
        type: "JÅ«ra",
        // Pataisyta: daug siauresnÄ—, Ä¯traukti Sueco ir Akabos kanalai virÅ¡uje
        polygon: [
            [29.9, 32.5],  // Sueco Ä¯lankos virÅ¡us
            [27.8, 33.7],  // Sinajaus pusiasalio apaÄia
            [29.5, 35.0],  // Akabos Ä¯lankos virÅ¡us
            [28.0, 34.7],  // Saudo Arabijos pakrantÄ—
            [25.0, 37.0],
            [20.0, 40.0],
            [16.5, 42.5],
            [13.0, 43.5],  // Jemeno pakrantÄ— (prie Bab el Mandebo)
            [12.5, 43.3],  // SÄ…siauris
            [11.5, 43.0],  // DÅ¾ibutis
            [15.0, 41.0],  // EritrÄ—ja
            [20.0, 37.5],  // Sudanas
            [25.0, 35.0],  // Egiptas
            [29.9, 32.5]
        ]
    },
{
        name: "Beringo jÅ«ra",
        type: "JÅ«ra",
        polygon: [
            [66.0, -169.0], // Beringo sÄ…siauris
            [64.0, -161.0], // Aliaskos Ä¯lankos
            [56.0, -159.0], // Aliaskos pusiasalis
            [54.0, -166.0], // AleutÅ³ salos (pradÅ¾ia)
            [52.0, -174.0], // AleutÅ³ salos (vidurys)
            [52.0, -179.9], // Riba ties data (VakarÅ³ pusÄ—)
            [60.0, -179.9], // Riba ties data (Rusijos pusÄ—, bet laikomÄ—s -179.9)
            [62.0, -175.0],
            [64.5, -172.0], // ÄŒiukÄiÅ³ pusiasalio apaÄia
            [66.0, -169.0]
        ]
    },
    {
        name: "Tasmano jÅ«ra",
        type: "JÅ«ra",
        polygon: [
            [-35.0, 151.0], [-35.0, 172.0], [-45.0, 167.0], [-40.0, 150.0], 
            [-35.0, 151.0]
        ]
    },

    // --- Ä®LANKOS ---
    {
        name: "BengalÅ³ (Bengalijos) Ä¯lanka",
        type: "Ä®lanka",
        polygon: [
            [22.0, 88.0], [20.0, 93.0], [10.0, 98.0], [8.0, 82.0], 
            [22.0, 88.0]
        ]
    },
    {
        name: "PersÅ³ (Persijos) Ä¯lanka",
        type: "Ä®lanka",
        polygon: [
            [30.0, 48.0], [27.0, 51.0], [25.0, 55.0], [24.0, 53.0], 
            [29.0, 48.0], [30.0, 48.0]
        ]
    },
    {
        name: "Meksikos Ä¯lanka",
        type: "Ä®lanka",
        polygon: [
            [30.0, -90.0], [30.0, -85.0], [25.0, -82.0], [22.0, -85.0], 
            [20.0, -95.0], [25.0, -97.0], [30.0, -90.0]
        ]
    },
    {
        name: "Biskajos Ä¯lanka",
        type: "Ä®lanka",
        polygon: [
            [47.0, -5.0], [45.0, -1.5], [43.5, -2.0], [43.5, -5.0], 
            [47.0, -5.0]
        ]
    },
    {
        name: "GvinÄ—jos Ä¯lanka",
        type: "Ä®lanka",
        polygon: [
            [5.0, -5.0], [4.0, 9.0], [-2.0, 9.0], [5.0, -5.0]
        ]
    },
    {
        name: "Kalifornijos Ä¯lanka",
        type: "Ä®lanka",
        polygon: [
            [31.5, -114.0], [23.0, -109.0], [24.0, -108.0], [31.5, -114.0]
        ]
    },
    {
        name: "Karpentarios Ä¯lanka",
        type: "Ä®lanka",
        polygon: [
            [-11.0, 136.0], [-16.0, 138.0], [-17.0, 140.0], [-11.0, 142.0], 
            [-11.0, 136.0]
        ]
    },
    {
        name: "Hadsono Ä¯lanka",
        type: "Ä®lanka",
        polygon: [
            [63.0, -90.0], [60.0, -80.0], [55.0, -80.0], [57.0, -90.0], 
            [63.0, -90.0]
        ]
    },

    // --- SÄ„SIAURIAI ---
    {
        name: "Beringo sÄ…siauris",
        type: "SÄ…siauris",
        polygon: [
            [66.5, -170.0], [66.5, -168.0], [65.5, -168.0], [65.5, -170.0], 
            [66.5, -170.0]
        ]
    },
    {
        name: "Dreiko sÄ…siauris",
        type: "SÄ…siauris",
        polygon: [
            [-56.0, -68.0], [-60.0, -68.0], [-60.0, -60.0], [-56.0, -65.0], 
            [-56.0, -68.0]
        ]
    },
    {
        name: "Magelano sÄ…siauris",
        type: "SÄ…siauris",
        polygon: [
            [-52.5, -70.0], [-53.0, -71.0], [-54.0, -71.0], [-52.5, -68.5], 
            [-52.5, -70.0]
        ]
    },
    {
        name: "Gibraltaro sÄ…siauris",
        type: "SÄ…siauris",
        polygon: [
            [36.2, -5.8], [36.2, -5.2], [35.8, -5.2], [35.8, -5.8], 
            [36.2, -5.8]
        ]
    },
    {
        name: "Mozambiko sÄ…siauris",
        type: "SÄ…siauris",
        polygon: [
            [-12.0, 40.5], [-12.0, 43.0], [-25.0, 44.0], [-25.0, 35.0], 
            [-12.0, 40.5]
        ]
    },

    // --- KANALAI (Palikti kaip taÅ¡kai, nes tai logiÅ¡kiausia Å¡iame mastelyje) ---
    {
        name: "Sueco kanalas",
        type: "Kanalas",
        lat: 30.6, lng: 32.3, tolerance: 100000
    },
    {
        name: "Panamos kanalas",
        type: "Kanalas",
        lat: 9.1, lng: -79.7, tolerance: 100000
    }
];

    let currentIdx = 0;
    let score = 0;
    let maxScore = 0;
    let isAnswered = false;
    let activeMarkers = [];
    let examQuestions = [];
    let totalQuestions = 10;
    let results = []; // Saugome kiekvieno klausimo rezultatus

    const questionText = document.getElementById("question-text");
    const feedbackText = document.getElementById("feedback");
    const nextBtn = document.getElementById("next-btn");
    const scoreEl = document.getElementById("score");
    const maxScoreEl = document.getElementById("max-score");
    const questionNumEl = document.getElementById("question-num");
    const totalQuestionsEl = document.getElementById("total-questions");
    const avgScoreEl = document.getElementById("avg-score");

    // Funkcijos tipÅ³ pasirinkimui
    function selectAllTypes() {
        document.querySelectorAll('.type-checkbox').forEach(cb => cb.checked = true);
    }

    function deselectAllTypes() {
        document.querySelectorAll('.type-checkbox').forEach(cb => cb.checked = false);
    }

    // Funkcija gauti pasirinktus tipus
    function getSelectedTypes() {
        const typeMap = {
            'type-sala': 'Sala',
            'type-salynas': 'Salynas',
            'type-pusiasalis': 'Pusiasalis',
            'type-jura': 'JÅ«ra',
            'type-ilanka': 'Ä®lanka',
            'type-sasiauris': 'SÄ…siauris',
            'type-kanalas': 'Kanalas'
        };

        const selected = [];
        for (const [id, type] of Object.entries(typeMap)) {
            if (document.getElementById(id).checked) {
                selected.push(type);
            }
        }
        return selected;
    }

    // Funkcija pradÄ—ti egzaminÄ…
    function startExam(numQuestions) {
        // Gauti pasirinktus tipus
        const selectedTypes = getSelectedTypes();

        if (selectedTypes.length === 0) {
            alert('Pasirinkite bent vienÄ… objekto tipÄ…!');
            return;
        }

        // Filtruoti vietoves pagal pasirinktus tipus
        const filteredLocations = locations.filter(loc => selectedTypes.includes(loc.type));

        if (filteredLocations.length === 0) {
            alert('NÄ—ra vietoviÅ³ su pasirinktais tipais!');
            return;
        }

        // Nustatyti klausimÅ³ skaiÄiÅ³
        if (numQuestions === 'all') {
            totalQuestions = filteredLocations.length;
        } else {
            totalQuestions = Math.min(numQuestions, filteredLocations.length);
        }

        // IÅ¡maiÅ¡ome ir paimame reikiamÄ… kiekÄ¯ klausimÅ³
        const shuffled = [...filteredLocations].sort(() => Math.random() - 0.5);
        examQuestions = shuffled.slice(0, totalQuestions);

        // PaslÄ—pti pradÅ¾ios ekranÄ…
        document.getElementById("start-screen").style.display = "none";

        // Atnaujinti UI
        totalQuestionsEl.innerText = totalQuestions;
        maxScoreEl.innerText = totalQuestions * 100;

        // PradÄ—ti pirmÄ… klausimÄ…
        showQuestion();
    }

    function showQuestion() {
        if (currentIdx >= examQuestions.length) {
            endGame();
            return;
        }

        const loc = examQuestions[currentIdx];
        questionText.innerHTML = `Rask Å¡iÄ… vietÄ…: <span class="target-name">${loc.name}</span> (${loc.type})`;
        feedbackText.innerHTML = "SpustelÄ—k Å¾emÄ—lapyje";
        feedbackText.className = "";
        nextBtn.style.display = "none";
        isAnswered = false;

        // Atnaujinti klausimo numerÄ¯
        questionNumEl.innerText = currentIdx + 1;

        // IÅ¡valome senus markerius
        activeMarkers.forEach(layer => map.removeLayer(layer));
        activeMarkers = [];
    }

    // Funkcija skaiÄiuoti taÅ¡kus pagal atstumÄ…
    function calculatePoints(distance, isInside = false) {
        if (isInside) return 100; // Pilni taÅ¡kai jei pataikÄ— Ä¯ teritorijÄ…

        // TaÅ¡kÅ³ skaiÄiavimas pagal atstumÄ… (kilometrais) - didesnÄ—s paklaidos
        const km = distance / 1000;

        if (km <= 100) return 95;
        if (km <= 250) return 90;
        if (km <= 500) return 85;
        if (km <= 750) return 75;
        if (km <= 1000) return 65;
        if (km <= 1500) return 50;
        if (km <= 2000) return 35;
        if (km <= 3000) return 20;
        if (km <= 4000) return 10;
        if (km <= 5000) return 5;
        return 0;
    }

    // Funkcija tikrinti ar taÅ¡kas yra poligono viduje (Ray Casting algoritmas)
    function isPointInPolygon(point, polygon) {
        let x = point.lat, y = point.lng;
        let inside = false;
        for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
            let xi = polygon[i][0], yi = polygon[i][1];
            let xj = polygon[j][0], yj = polygon[j][1];
            let intersect = ((yi > y) !== (yj > y))
                && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
            if (intersect) inside = !inside;
        }
        return inside;
    }

    // Paspaudimo logika
    map.on('click', function(e) {
        if (isAnswered) return;

        isAnswered = true;
        const target = examQuestions[currentIdx];
        const clickLatLng = e.latlng;

        // Pavaizduojame kur paspaudÄ— vartotojas
        const userMarker = L.marker(clickLatLng).addTo(map).bindPopup("Tavo spÄ—jimas").openPopup();
        activeMarkers.push(userMarker);

        let earnedPoints = 0;
        let distance = null;
        let isInside = false;

        // Jei objektas turi poligonÄ… - tikriname ar paspaudimas yra viduje
        if (target.polygon) {
            isInside = isPointInPolygon(clickLatLng, target.polygon);

            // Jei nepataikÄ— Ä¯ vidÅ³, skaiÄiuojame atstumÄ… iki artimiausio poligono taÅ¡ko
            if (!isInside) {
                distance = Infinity;
                target.polygon.forEach(point => {
                    const polyPoint = L.latLng(point[0], point[1]);
                    const dist = clickLatLng.distanceTo(polyPoint);
                    if (dist < distance) distance = dist;
                });
            }

            // Pavaizduojame tikrÄ… teritorijÄ…
            const polygonLayer = L.polygon(target.polygon, {
                color: isInside ? 'green' : (distance < 500000 ? 'orange' : 'red'),
                fillColor: isInside ? 'green' : (distance < 500000 ? 'orange' : 'red'),
                fillOpacity: 0.2
            }).addTo(map).bindPopup(target.name);
            activeMarkers.push(polygonLayer);

            // SkaiÄiuojame taÅ¡kus
            earnedPoints = calculatePoints(distance || 0, isInside);

            if (isInside) {
                feedbackText.innerHTML = `ğŸ¯ Puiku! Pataikei Ä¯ ${target.name}! (+${earnedPoints} tÅ¡k.)`;
                feedbackText.className = "correct";
            } else {
                const km = (distance / 1000).toFixed(0);
                if (earnedPoints > 0) {
                    feedbackText.innerHTML = `ğŸ“ Arti! NutolÄ™s ${km} km nuo ${target.name}. (+${earnedPoints} tÅ¡k.)`;
                    feedbackText.className = "partial";
                } else {
                    feedbackText.innerHTML = `âŒ Nepataikei. Tai buvo ${target.name} (nutolÄ™s ${km} km). (+0 tÅ¡k.)`;
                    feedbackText.className = "incorrect";
                }
            }
        } else {
            // Kanalams - tikslus taÅ¡kas
            const targetLatLng = L.latLng(target.lat, target.lng);
            distance = clickLatLng.distanceTo(targetLatLng);

            const correctMarker = L.circleMarker(targetLatLng, {
                color: 'green',
                radius: 10
            }).addTo(map).bindPopup(target.name);
            activeMarkers.push(correctMarker);

            const line = L.polyline([clickLatLng, targetLatLng], {color: 'blue', dashArray: '5, 10'}).addTo(map);
            activeMarkers.push(line);

            // SkaiÄiuojame taÅ¡kus
            earnedPoints = calculatePoints(distance);
            const km = (distance / 1000).toFixed(0);

            if (earnedPoints >= 90) {
                feedbackText.innerHTML = `ğŸ¯ Puikiai! Atstumas ${km} km. (+${earnedPoints} tÅ¡k.)`;
                feedbackText.className = "correct";
            } else if (earnedPoints > 0) {
                feedbackText.innerHTML = `ğŸ“ Gerai! Atstumas ${km} km. (+${earnedPoints} tÅ¡k.)`;
                feedbackText.className = "partial";
            } else {
                feedbackText.innerHTML = `âŒ Per toli - ${km} km. (+0 tÅ¡k.)`;
                feedbackText.className = "incorrect";
            }
        }

        // Saugome rezultatÄ…
        results.push({
            location: target.name,
            type: target.type,
            points: earnedPoints,
            distance: distance ? (distance / 1000).toFixed(0) : 0,
            isInside: isInside
        });

        // Atnaujinti taÅ¡kus
        score += earnedPoints;
        maxScore += 100;
        scoreEl.innerText = Math.round(score);
        maxScoreEl.innerText = maxScore;

        // SkaiÄiuoti vidurkÄ¯
        const avg = (score / maxScore * 100).toFixed(1);
        avgScoreEl.innerText = avg;

        nextBtn.style.display = "inline-block";
    });

    function nextLevel() {
        currentIdx++;
        showQuestion();
    }

    function endGame() {
        const percentage = (score / maxScore * 100).toFixed(1);
        let grade = "";
        let gradeClass = "";

        if (percentage >= 90) {
            grade = "PUIKIAI! ğŸŒŸ";
            gradeClass = "grade-excellent";
        } else if (percentage >= 75) {
            grade = "GERAI! âœ“";
            gradeClass = "grade-good";
        } else if (percentage >= 50) {
            grade = "PATENKINAMAI";
            gradeClass = "grade-good";
        } else {
            grade = "NEPAKANKA";
            gradeClass = "grade-fail";
        }

        // Sukurti rezultatÅ³ lentelÄ™
        let tableHTML = `
            <h2 class="${gradeClass}">${grade}</h2>
            <h3>Galutinis rezultatas: ${Math.round(score)} / ${maxScore} (${percentage}%)</h3>
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>VietovÄ—</th>
                        <th>Tipas</th>
                        <th>TaÅ¡kai</th>
                        <th>Nutolimas</th>
                    </tr>
                </thead>
                <tbody>
        `;

        results.forEach((result, idx) => {
            const pointClass = result.points >= 90 ? 'correct' : (result.points > 0 ? 'partial' : 'incorrect');
            tableHTML += `
                <tr>
                    <td>${idx + 1}</td>
                    <td>${result.location}</td>
                    <td>${result.type}</td>
                    <td class="${pointClass}">${result.points}/100</td>
                    <td>${result.isInside ? 'âœ“ Viduje' : result.distance + ' km'}</td>
                </tr>
            `;
        });

        tableHTML += `
                </tbody>
            </table>
            <button class="btn btn-secondary" onclick="location.reload()" style="margin-top: 20px;">ğŸ”„ Naujas egzaminas</button>
        `;

        questionText.innerHTML = `Egzaminas baigtas!`;
        feedbackText.innerHTML = `<div id="results-table">${tableHTML}</div>`;
        nextBtn.style.display = "none";
    }

</script>

</body>
</html>
